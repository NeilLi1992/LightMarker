var Model={};Model.db=null;Model.init=function(c){var a=1;var b=function(){Model.createObjectStore("Entries","timeStamp");Model.createObjectStore("Lists","id");
};Model.open(a,b,c);};Model.isIDBSupported=function(){if("indexedDB" in window){return true;}else{return false;}};Model.toString=function(){return"Model.toString 方法待实现";
};Model.open=function(a,c,d){var b=indexedDB.open("LightMarker",a);b.onupgradeneeded=function(f){Model.db=f.target.result;c();};b.onsuccess=function(f){Model.db=f.target.result;
if(d&&typeof d==="function"){d();}};b.onerror=function(f){console.log("IDB open error!");console.log(f);};};Model.createObjectStore=function(b,a){if(Model.db!=null){if(!Model.db.objectStoreNames.contains(b)){if(a!==undefined){Model.db.createObjectStore(b,{keyPath:a});
}else{Model.db.createObjectStore(b);}}else{console.log("Object store 创建失败，指定的os已存在。");}}else{console.log("IDB尚未打开，Model.db对象为null。");}};Model.addToStore=function(d,e,f){if(Model.db!=null){var b=Model.db.transaction([e],"readwrite");
b.oncomplete=function(){console.log("添加数据成功！");if(f&&typeof f==="function"){f();}};var a=b.objectStore(e);var c=a.add(d);}else{console.log("添加数据失败，IDB尚未打开，Model.db对象为null。");
}};Model.getFromStore=function(c,e,f){if(Model.db!=null){var b=Model.db.transaction([e],"readonly");var a=b.objectStore(e);var d=a.get(c);d.onerror=function(g){console.log("获取数据失败 ",g.target.error.name);
};d.onsuccess=function(g){if(g.target.result===undefined){console.log("未能获取数据，数据可能不存在。");}else{console.log("获取数据成功！");if(f&&typeof f==="function"){f(g.target.result);
}}};}else{console.log("获取数据失败，IDB尚未打开，Model.db对象为null。");}};Model.getAllFromStore=function(d,f){if(Model.db!=null){var b=Model.db.transaction([d],"readonly");
var a=b.objectStore(d);var c=a.openCursor();var e={};c.onsuccess=function(h){var g=h.target.result;if(g){e[g.key]=g.value;g["continue"]();}else{console.log("获取全部数据成功！");
if(f&&typeof f==="function"){f(e);}}};}else{console.log("获取全部数据失败，IDB尚未打开，Model.db对象为null。");}};Model.putToStore=function(d,e,f){if(Model.db!=null){var b=Model.db.transaction([e],"readwrite");
b.oncomplete=function(){console.log("更新数据成功！");if(f&&typeof f==="function"){f();}};var a=b.objectStore(e);var c=a.put(d);}else{console.log("更新数据失败，IDB尚未打开，Model.db对象为null。");
}};Model.deleteFromStore=function(b,d,e){if(Model.db!=null){var a=Model.db.transaction([d],"readwrite");a.oncomplete=function(){if(e&&typeof e==="function"){e();
}};var c=a.objectStore(d)["delete"](b);}else{console.log("删除数据失败，IDB尚未打开，Model.db对象为null。");}};Model.countStore=function(f,g){if(Model.db!=null){if(Model.db.objectStoreNames.contains(f)){var d=Model.db.transaction([f],"readonly");
var a=d.objectStore(f);var b=IDBKeyRange.lowerBound(0);var e=a.openCursor(b);var c=0;e.onsuccess=function(i){var h=i.target.result;if(h){c=c+1;h["continue"]();
}else{if(g&&typeof g==="function"){g(c);}}};}else{console.log("获取object store数据个数失败，指定的os不存在。");}}else{console.log("获取object store数据个数失败，IDB尚未打开，Model.db对象为null。");
}};Model.clearStore=function(e,f){if(Model.db!=null){if(Model.db.objectStoreNames.contains(e)){var c=Model.db.transaction([e],"readwrite");c.oncomplete=function(){console.log("Object store "+e+"已被清空");
if(f&&typeof f==="function"){f();}};var a=c.objectStore(e);var b=IDBKeyRange.lowerBound(0);var d=a["delete"](b);}else{console.log("清空os失败，指定的os不存在。");}}else{console.log("清空os失败，IDB尚未打开，Model.db对象为null。");
}};